<Window x:Class="AlgebraSQLizer.Dash"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:AlgebraSQLizer"
        Title="Dashboard" Height="450" Width="800"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent">
    <Window.Resources>
        <!-- Custom ScrollBar Style -->
        <Style x:Key="CustomScrollBarStyle" TargetType="ScrollBar">
            <Setter Property="Background" Value="#2E2E2E" />
            <Setter Property="Foreground" Value="#55B155" />
            <Setter Property="Width" Value="7" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid>
                            <Track Name="PART_Track" IsDirectionReversed="true">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Style="{x:Null}" Height="0" />
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Background="#4D4D4D" BorderThickness="0" />
                                </Track.Thumb>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Style="{x:Null}" Height="0" />
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Chat Drawer Slide In/Out Animations -->
        <!-- When closed, ChatDrawer's TranslateTransform.X is 270 (so only the 30px SlideButton is visible) -->
        <Storyboard x:Key="SlideIn">
            <DoubleAnimation Storyboard.TargetName="ChatDrawerTransform" 
                             Storyboard.TargetProperty="X" 
                             From="270" To="0" Duration="0:0:0.3"/>
        </Storyboard>
        <Storyboard x:Key="SlideOut">
            <DoubleAnimation Storyboard.TargetName="ChatDrawerTransform" 
                             Storyboard.TargetProperty="X" 
                             From="0" To="270" Duration="0:0:0.3"/>
        </Storyboard>

        <!-- Bottom Bar Vertical Animations (for mouse enter/leave) -->
        <!-- When hidden, BottomBar's TranslateTransform.Y is 80 (so only the top 20px show) -->
        <Storyboard x:Key="BottomBarShow">
            <DoubleAnimation Storyboard.TargetName="BottomBarTransform" 
                             Storyboard.TargetProperty="Y" 
                             From="80" To="0" Duration="0:0:0.3"/>
        </Storyboard>
        <Storyboard x:Key="BottomBarHide">
            <DoubleAnimation Storyboard.TargetName="BottomBarTransform" 
                             Storyboard.TargetProperty="Y" 
                             From="0" To="80" Duration="0:0:0.3"/>
        </Storyboard>

        <!-- Menu Item Style -->
        <Style x:Key="MenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="#383838" />
            <Setter Property="Foreground" Value="#CFC9C4" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3D3D3D" />
                    <Setter Property="Foreground" Value="#CFC9C4" />
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="SteelBlue" />
                    <Setter Property="Foreground" Value="White" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Navigation Button Style -->
        <Style x:Key="NavigationButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#383838"/>
            <Setter Property="Foreground" Value="#CFC9C4"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3D3D3D"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="SteelBlue"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- SlideButton Style for the Chat Drawer -->
        <Style x:Key="SlideButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="70"/>
            <Setter Property="Background" Value="#555555"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="5"
                                BorderBrush="#4C4481" BorderThickness="1">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#777777"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="SteelBlue"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Navigation Title Style (non-clickable section headers) -->
        <Style x:Key="NavigationTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Margin" Value="10,15,10,5"/>
        </Style>

        <!-- Converter for dynamically computing BottomBar Margin -->
        <local:BottomBarMarginConverter x:Key="BottomBarMarginConverter"/>
    </Window.Resources>

    <!-- Outer Border (with rounded corners) plus global DragMove handling -->
    <Border CornerRadius="10" Background="#2E2E2E" BorderThickness="1" BorderBrush="Black"
            MouseLeftButtonDown="Border_MouseLeftButtonDown">
        <Grid>
            <!-- Content Layer -->
            <Grid x:Name="ContentGrid">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!-- Menu Bar -->
                <Menu Grid.Row="0" Background="#383838" Foreground="#2E2E2E">
                    <MenuItem Header="File" Style="{StaticResource MenuItemStyle}">
                        <MenuItem Header="New" Style="{StaticResource MenuItemStyle}" />
                        <MenuItem Header="Open" Style="{StaticResource MenuItemStyle}" />
                        <MenuItem Header="Save AS..." Style="{StaticResource MenuItemStyle}">
                            <MenuItem Header="Algebra" Style="{StaticResource MenuItemStyle}" />
                            <MenuItem Header="Query" Style="{StaticResource MenuItemStyle}" />
                        </MenuItem>
                    </MenuItem>
                    <MenuItem Header="Connection" Style="{StaticResource MenuItemStyle}">
                        <MenuItem Header="Host Settings" Style="{StaticResource MenuItemStyle}" />
                        <MenuItem Header="Guest" Style="{StaticResource MenuItemStyle}" />
                        <MenuItem Header="Paste" Style="{StaticResource MenuItemStyle}" />
                    </MenuItem>
                    <MenuItem Header="View" Style="{StaticResource MenuItemStyle}">
                        <MenuItem Header="Toolbar" Style="{StaticResource MenuItemStyle}" />
                        <MenuItem Header="Status Bar" Style="{StaticResource MenuItemStyle}" />
                    </MenuItem>
                </Menu>
                <!-- Main Content Area -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <!-- Navigation Panel -->
                    <StackPanel x:Name="NavigationPanel" Grid.Column="0" Background="#383838" VerticalAlignment="Stretch">
                        <TextBlock Text="Section 1" Style="{StaticResource NavigationTitleStyle}"/>
                        <Button Content="Home" Style="{StaticResource NavigationButtonStyle}" Click="NavigationButton_Click"/>
                        <Button Content="Play List" Style="{StaticResource NavigationButtonStyle}" Click="NavigationButton_Click"/>
                        <TextBlock Text="Section 2" Style="{StaticResource NavigationTitleStyle}"/>
                        <Button Content="Item3" Style="{StaticResource NavigationButtonStyle}" Click="NavigationButton_Click"/>
                        <Button Content="Item4" Style="{StaticResource NavigationButtonStyle}" Click="NavigationButton_Click"/>
                    </StackPanel>
                    <!-- Main Content -->
                    <ContentControl x:Name="MainContent" Grid.Column="1" Background="#2E2E2E">
                        <TextBlock Text="Default Main Content" Foreground="White" FontSize="24"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </ContentControl>
                </Grid>
            </Grid>

            <!-- Overlay Layer: Global Chat Drawer (with integrated SlideButton) -->
            <Grid x:Name="ChatDrawer" HorizontalAlignment="Right" VerticalAlignment="Stretch" Width="300" Panel.ZIndex="2">
                <Grid.RenderTransform>
                    <!-- When closed, X=270 so only the 30px SlideButton shows -->
                    <TranslateTransform x:Name="ChatDrawerTransform" X="270"/>
                </Grid.RenderTransform>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="30"/>
                        <ColumnDefinition Width="270"/>
                    </Grid.ColumnDefinitions>
                    <!-- SlideButton -->
                    <Button x:Name="SlideButton" Style="{StaticResource SlideButtonStyle}" Grid.Column="0"
                            Click="SlideButton_Click"/>
                    <!-- Chat Content Area -->
                    <Border Grid.Column="1" Background="#4D4D4D">
                        <Grid>
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="0,10,0,45">
                                <ScrollViewer.Resources>
                                    <Style TargetType="ScrollBar" BasedOn="{StaticResource CustomScrollBarStyle}"/>
                                </ScrollViewer.Resources>
                                <StackPanel x:Name="MessagesContainer" Margin="10">
                                    <!-- Chat messages will be added dynamically here -->
                                </StackPanel>
                            </ScrollViewer>
                            <!-- Chat Input Section -->
                            <Grid VerticalAlignment="Bottom" Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="MessageTextBox" Width="200" Height="30" 
                                         Background="#252526" Foreground="White" BorderBrush="#4C4481" BorderThickness="1" 
                                         FontSize="14" Grid.Column="0" KeyDown="MessageTextBox_KeyDown"/>
                                <Button x:Name="SendButton" Content="Send" Width="80" Height="30" 
                                        Background="#383838" Foreground="White" BorderBrush="#4C4481" BorderThickness="2" FontSize="14"
                                        VerticalAlignment="Center" HorizontalAlignment="Right" Grid.Column="1" 
                                        Click="SendButton_Click" Margin="5,0,0,0"/>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>

            <!-- Overlay Layer: Bottom Bar -->
            <!-- The Bottom Bar dynamically sets its right margin based on the ChatDrawer's visible content width.
                 The converter now subtracts the SlideButton width (30) so that it sticks to the right edge of the ScrollViewer. -->
            <Grid x:Name="BottomBar" HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Height="100" Panel.ZIndex="1"
                  MouseEnter="BottomBar_MouseEnter" MouseLeave="BottomBar_MouseLeave">
                <Grid.RenderTransform>
                    <!-- When hidden, Y=80 so only the top 20px show -->
                    <TranslateTransform x:Name="BottomBarTransform" Y="80"/>
                </Grid.RenderTransform>
                <Grid.Margin>
                    <MultiBinding Converter="{StaticResource BottomBarMarginConverter}">
                        <!-- Bind the drawer's Width and its animated TranslateTransform.X -->
                        <Binding ElementName="ChatDrawer" Path="Width"/>
                        <Binding ElementName="ChatDrawerTransform" Path="X"/>
                    </MultiBinding>
                </Grid.Margin>
                <Border Background="#55b155" CornerRadius="10,0,0,0">
                    <TextBlock Text="Status Bar" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center" 
                               FontSize="16" FontWeight="Bold"/>
                </Border>
            </Grid>

        </Grid>
    </Border>
</Window>
